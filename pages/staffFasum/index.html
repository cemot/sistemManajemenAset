  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../bower_components/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="../../bower_components/Ionicons/css/ionicons.min.css">
  <link rel="stylesheet" href="../../dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="../../dist/css/skins/_all-skins.min.css">
  <link rel="stylesheet" href="../../bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
  <link rel="stylesheet" href="../../bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
 <section class="content-header">
      <h1>Data Permintaan</h1>
      <ol class="breadcrumb">
        <li><i class="fa fa-home"></i> Home</li>
      </ol>
 </section>
 <section class="content">
      <div class="box">
        <div class="box-header with-border">
          <h3 class="box-title">Data Permintaan Aset</h3>
          <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
              <i class="fa fa-minus"></i></button>
          </div>
        </div>
        <div class="box-body">
         <table id="example1" class="table table-bordered table-striped">
            <thead>
            <tr>
              <th>Kode</th>
              <th>Jenis</th>
              <th>Tanggal Permohonan</th>
              <th>Jumlah</th>
              <th>Prioritas</th>
              <th></th>
            </tr>
            </thead>
            <tbody>

            </tbody>
         </table>
        </div>
        <!-- /.box-body -->
        <div class="box-footer">
          <a href="#" data-toggle="modal" data-target="#modal-tanggapi"><button type="submit" class="btn btn-success pull-right">Tanggapi Permintaan</button></a>
        </div>
        <!-- /.box-footer-->
      </div>
      <div class="modal fade" id="modal-detail">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Detail Pengadaan</h4>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label for="inputEmail3" class="col-sm-2 control-label" >Kode Pengadaan</label>

                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="detail1" value="" disabled>
                  </div>
                </div><br><br>
                 <div class="form-group">
                  <label for="inputEmail3" class="col-sm-2 control-label" >Jenis</label>

                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="detail2" value="Laptop" disabled>
                  </div>
                </div><br><br>
                <div class="form-group">
                  <label for="inputEmail3" class="col-sm-2 control-label" >Jumlah</label>

                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="detail3" value="10" disabled>
                  </div>
                </div><br><br>
                  <div class="form-group">
                  <label for="inputEmail3" class="col-sm-2 control-label" >Prioritas</label>

                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="detail4" value="High" disabled>
                  </div>
                </div><br><br>
                <div class="form-group">
                  <label for="inputEmail3" class="col-sm-2 control-label" >Tanggal Permohonan</label>

                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="detail5" value="9/10/2018" disabled>
                  </div>
                </div><br><br>
                <div class="form-group">
                  <label for="inputEmail3" class="col-sm-2 control-label" >Status</label>

                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="detail5" value="Meminta Pengadaan" disabled>
                  </div>
                </div><br><br>
             </div>
            </div>
            <!-- /.modal-content -->
          </div>
          <!-- /.modal-dialog -->
        </div>
        <div class="modal fade" id="modal-tanggapi">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Tanggapi Permintaan</h4>
              </div>
              <div class="modal-body">
                 <div id="field">
                <div id="field0">
                  <div class="form-group">
                  <label for="inputEmail3" class="col-sm-2 control-label" >Tanggal Approval</label>

                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="datepicker" placeholder="Tanggal Approval">
                  </div>
                </div><br><br><br>
                <button id="add-more" name="add-more" class="btn btn-primary pull-right"><i class="fa fa-plus"></i></button><br><br>
                <div class="form-group">
                  <label for="jenis" class="col-sm-2 control-label" >Jenis</label>

                  <div class="col-sm-10">
                    <select class="form-control selectAset" id="select_0">
                    </select>
                    </div>
                  </div><br>
                  
                <div class="form-group">
                  <label for="jumlah" class="col-sm-2 control-label">Jumlah</label>

                  <div class="col-sm-10">
                    <input type="number" class="form-control" id="input_0" placeholder="Jumlah Aset" >
                  </div>
                </div><br>
                <div class="form-group">
                    <label for="jumlah" class="col-sm-2 control-label">Harga</label>
  
                    <div class="col-sm-10">
                      <input type="number" class="form-control" id="harga_0" placeholder="Harga Aset" >
                    </div>
                  </div><br><br>
              </div>
             </div>
             </div>
             <div class="modal-footer">
              <a href="#" data-toggle="modal" data-target="#modal-konfirmasi-no"><button type="submit" class="btn btn-danger pull-left">Tolak Permintaan</button></a>
              <a href="#" data-toggle="modal" data-target="#modal-konfirmasi-yes"><button type="submit" class="btn btn-success pull-right">Terima Permintaan</button></a>
             </div>
            </div>
            <!-- /.modal-content -->
          </div>
          <!-- /.modal-dialog -->
        </div>
        <div class="modal fade" id="modal-terima">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-body">
                 <center><h3>Permintaan Berhasil Diterima</h3></center>
             <div class="modal-footer">
               <a href="index.html"><button type="submit" class="btn btn-default pull-right">Close</button></a>
             </div>
            </div>
            <!-- /.modal-content -->
          </div>
          <!-- /.modal-dialog -->
        </div>
      </div>
            <!-- modal konfirmasi-->
<div id="modal-konfirmasi-no" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
 <div class="modal-dialog">
  <div class="modal-content">
 
   <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Konfirmasi</h4>
   </div>
 
   <div class="modal-body">
    <b>Apakah Anda yakin ingin Menolak permintaan ini?</b>
   </div>
 
   <div class="modal-footer">
     <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal-tolak">Ya</button>
     <button type="button" class="btn btn-success" data-dismiss="modal">Tidak</button>
   </div>
 
  </div>
 </div>
</div>
            <!-- modal konfirmasi-->
<div id="modal-konfirmasi-yes" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
 <div class="modal-dialog">
  <div class="modal-content">
 
   <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Konfirmasi</h4>
   </div>
 
   <div class="modal-body">
    <b>Apakah Anda yakin ingin Menerima Permintaan ini?</b>
   </div>
 
   <div class="modal-footer">
     <button id="submitBtn" type="button" class="btn btn-success">Ya</button>
     <button type="button" class="btn btn-danger" data-dismiss="modal">Tidak</button>
   </div>
 
  </div>
 </div>
</div>
  <div class="modal fade" id="modal-tolak">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Alasan Penolakan</h4>
          </div>
          <div class="modal-body">
              <textarea class="form-control" placeholder="Alasan Penolakan"></textarea>
          <div class="modal-footer">
            <a href="index.html"><button type="submit" class="btn btn-success pull-right">Simpan</button></a>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
  </div>

  </section>

 <!-- jQuery 3 -->
<script src="../../bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="../../bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<script src="../../bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../../bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<script src="../../bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<!-- FastClick -->
<script src="../../bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../dist/js/demo.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
<script>
  //date
  $('#datepicker').datepicker({
      autoclose: true
    })

  function loadTable(data) {
    $("#example1 tody").html("")
    $.each(data, function(index, item) {
      if(item.status == 'Meminta Pengadaan'){
        $("#example1 tbody").append(`<tr>
          <td>${item.kode}</td>
          <td>${item.jenisAset}</td>
          <td>${item.tanggalPermohonan}</td>
          <td>${item.jumlah}</td>
          <td>${item.prioritas}</td>
          <td><a href="#" data-toggle="modal" data-target="#modal-detail" class="openDetail" data-item=${(item.kode)}>Detail</a></td>
        </tr>`)
      }
    });

    $('#example1').DataTable()
  }

  function loadPermintaan(data){
    $(".selectAset").html("")
    $.each(data, function(index, item) {
      if(item.status == 'Meminta Pengadaan'){
        $(".selectAset").append(`
          <option>${item.jenisAset} - ${item.kode}</option>
        `)
      }
    });
  }


  $(document).ready(function () {
    localStorage.setItem("tmp", "");
    var permintaan_aset = JSON.parse(localStorage.getItem("permintaan_aset"))
    loadTable(permintaan_aset)
    loadPermintaan(permintaan_aset)

    $(".openDetail").click(function(){
      var detail = _.find(permintaan_aset, { kode:  $(this).data("item")});
      $("#detail1").val(detail.kode)
      $("#detail2").val(detail.jenisAset)
      $("#detail3").val(detail.jumlah)
      $("#detail4").val(detail.prioritas)
      $("#detail5").val(detail.tanggalPermohonan)
      $("#detail6").val(detail.status)
    })

    var next = 0;
    $("#add-more").click(function(e){
        e.preventDefault();
        var addto = "#field" + next;
        var addRemove = "#field" + (next);
        next = next + 1;
        var newIn = '<div id="field'+ next +'" name="field'+ next +'">'+ 
                    '<div class="form-group"><label for="jenis" class="col-sm-2 control-label">Jenis</label><div class="col-sm-10">'+
                    '<select id="select_'+ next +'" class="form-control selectAset"></select></div></div><br>'+
                    '<div class="form-group"><label for="jumlah" class="col-sm-2 control-label">Jumlah</label>'+
                    '<div class="col-sm-10"><input id="input_'+ next+'" type="number" class="form-control" placeholder="Jumlah Aset"></div><br>' + 
                    '<div class="form-group"><label for="jumlah" class="col-sm-2 control-label">Harga</label>'+
                    '<div class="col-sm-10"><input id="harga_'+ next+'" type="number" class="form-control" placeholder="Jumlah Aset"></div></div></div><br><br>';
        var newInput = $(newIn);
        var removeBtn = '<button id="remove' +next+ '" class="btn btn-danger remove-me pull-right"><i class="fa fa-minus"></i></button></div></div><div id="field"><br>';
        var removeButton = $(removeBtn);
        $(addto).after(newInput);
        $(addRemove).after(removeButton);
        $("#field" + next).attr('data-source',$(addto).attr('data-source'));
        $("#count").val(next);  
        
        $('.remove-me').click(function(e){
          next = next-1;
            e.preventDefault();
            var fieldNum = this.id.charAt(this.id.length-1);
            var fieldID = "#field" + fieldNum;
            $(this).remove();
            $(fieldID).remove();
        });

        loadPermintaan(permintaan_aset)
    });

    $("#submitBtn").click(function() {
      var lists = []
      for(var i = 0; i <= next; i ++){
        lists.push({
          jenis: $("#select_" + i).val(),
          jumlah: $("#input_" + i).val(),
          harga: $("#harga_" + i).val(),
        })
      }
      
      var tmpPengadaan = {
        tanggalApproval: $("datepicker").val(),
        lists: lists
      }

      localStorage.setItem("tmp", JSON.stringify(tmpPengadaan));
      window.location = "tambahPengadaan.html"
    })

  });
  </script>
